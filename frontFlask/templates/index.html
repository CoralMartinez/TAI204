<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Usuarios - FastAPI</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 70%; margin-bottom: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        form { margin-top: 20px; }
        input { margin: 5px; padding: 8px; }
        button { padding: 6px 10px; margin: 2px; }
    </style>
</head>
<body>
    <h1>Tabla Ficticia de Usuarios</h1>

    <!-- Tabla de usuarios -->
    <table id="tablaUsuarios">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Edad</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- Formulario para agregar usuario -->
    <h2>Agregar Usuario</h2>
    <form id="usuarioForm">
        <label for="id">ID:</label>
        <input type="number" id="id" name="id" required><br>

        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" name="nombre" required><br>

        <label for="edad">Edad:</label>
        <input type="number" id="edad" name="edad" required><br>

        <button type="submit">Agregar</button>
    </form>

    <script>
        
    //GET
    async function cargarUsuarios() {
        const response = await fetch("http://127.0.0.1:5000/v1/usuarios/");
        const data = await response.json();
        const tbody = document.querySelector("#tablaUsuarios tbody");
        tbody.innerHTML = "";
        data.Usuarios.forEach(usuario => {
            const fila = document.createElement("tr");
            fila.innerHTML = `
                <td>${usuario.id}</td>
                <td>${usuario.nombre}</td>
                <td>${usuario.edad}</td>
                <td>
                    <button onclick="editarUsuario(${usuario.id}, '${usuario.nombre}', ${usuario.edad})">Editar</button>
                    <button onclick="eliminarUsuario(${usuario.id})">Eliminar</button>
                </td>
            `;
            tbody.appendChild(fila);
        });
    }

    //POST

    document.getElementById("usuarioForm").addEventListener("submit", async function(e) {
        e.preventDefault();
        const usuario = {
            id: parseInt(document.getElementById("id").value),
            nombre: document.getElementById("nombre").value,
            edad: parseInt(document.getElementById("edad").value)
        };
        const response = await fetch("http://127.0.0.1:5000/v1/usuarios/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(usuario)
        });
        const data = await response.json();
        alert(data.Mensaje);
        cargarUsuarios();
    });

    async function editarUsuario(id, nombre, edad) {
        const nuevoNombre = prompt("Nuevo nombre:", nombre);
        const nuevaEdad = prompt("Nueva edad:", edad);
        if (nuevoNombre && nuevaEdad) {
            const usuario = { nombre: nuevoNombre, edad: parseInt(nuevaEdad) };
            const response = await fetch(`http://127.0.0.1:5000/v1/usuarios/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(usuario)
            });
            const data = await response.json();
            alert(data.Mensaje);
            cargarUsuarios();
        }
    }

    async function eliminarUsuario(id) {
        if (confirm("Â¿Seguro que quieres eliminar este usuario?")) {
            const response = await fetch(`http://127.0.0.1:5000/v1/usurios/${id}`, {
                method: "DELETE"
            });
            const data = await response.json();
            alert(data.Mensaje);
            cargarUsuarios();
        }
    }

    cargarUsuarios();
    </script>
</body>
</html>